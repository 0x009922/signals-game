# views

Папка с модулями представления

-   `keys` - здесь компоненты для клавиш управления
-   `grid` - сетка с элементами
-   `capacity` - управление проводимостью среды
-   `chips` - элементы, которые будут на сетке располагаться

Какая вообще структура у приложения? Понятно, что должно быть одно единое хранилище с общим состоянием. Что в этом состоянии?

```ts
type Chips = // Перечисление всех чипов, которые будут использоваться

interface ApplicationState {
    /**
     * Список чипов, монтирование и демонтирование. Взаимодействие происходит внутри.
     */
    silicon: Silicon<Chips>;
    /**
     * Здесь та часть, которая отвечает за проводимость кремния
     */
    siliconEnvironment: ?;
    /**
     * Работа с клавиатурой. Через этот модуль можно будет говорить, какие клавиши ожидаются от пользователя,
     * получать состояния нажатия клавиш и так далее.
     */
    keyboard: ?;
}
```

### Клавиатура

Что с клавиатурой?

#### Клавиши создания

Есть несколько клавиш создания элементов - цифры. `1` - источник, `2` - светодиод, `3` - буффер, `4` - инвертор, `5` - мост. Из них одновременно может быть только одна активна. Если какая-то клавиша зажата и мышь находится над клеткой и клетка не занята тем элементом, который зажат, то в клетку ставится этот элемент (то, что было - удаляется).

#### Клавиша удаления. Ластик. Крестик. Паяльник.

При зажатой клавише удаления очищаются все клетки, находящиеся под курсором пользователя.

> Клавиша удаления не может активироваться, если уже зажата клавиша создания, и наоборот.

#### Спец. клавиши элементов

##### Источник

-   `E` - переключить состояние. Переключение срабатывает только при самом нажатии клавиши (`keydown`), а не при зажиме.

##### Светодиод

Нет активных действий, это датчик.

##### Буффер

-   `W`, `A`, `S`, `D` - клавиши переключения состояния для портов верхнего, левого, нижнего и правого соответственно. Состояний может быть два - либо `IN`, либо `OUT`. Переключение срабатывает на `keydown`

##### Инвертор

-   Клавиши `WASD` для указания направления, где у инвертора выход. Вход будет на противоположной стороне.

#### Мост (или, вернее, телепорт?)

-   Клавиши `WASD` для указания направления, где выход. Как у инвертора.
-   Клавиши `+` и `-` для корректировки дальности телепортации сигнала.

Конкретно для моста, конечно же, было бы удобнее мышью тыкать на клетку, куда надо перескакивать. Но стоит ли ради этого заморачиваться? **Нет, отложим фичу до лучших времён.**

---

Окей, с клавишами разобрались. Они будут располагаться где-нибудь снизу экрана и подсвечиваться при нажатиях пользователя. Желательно ещё подсвечивать такое состояние клавиш, когда они зажаты, но не активны (например, когда зажимается создание одного элемента, а затем других или удаления - они уже не активируются, для них особая подсветка)

### Мышь

Мышью пользователь будет управлять расположением элементов. Если мышь на доске, то нужно точно знать, над какой клеткой она сейчас находится, что там за элемент, и так далее.

**Подсветка клеток, в которые из текущей исходят сигналы.** Это не обязательно впиливать в первую версию, но предусмотреть надо. Как работает: наводишь мышь на клетку с каким-то элементом и видишь, куда он вообще излучает. Тут вопрос - показывать ли действительное текущее излучение, или нечто другое, дополнительная информация от самого элемента?

### Сетка

Сетка состоит из клеточек. Декартова система. Одновременно под мышью на сетке может быть только одна клетка активной. Отображаются только спец клавиши активной клетки, и слушаются события от неё.

Хорошо бы сетку двигать плавно мышью, но это не MWP.

Сетка должна уметь подсвечивать отдельные клетки, если её попросить. Допустим, это необходимо для моста, чтобы видеть, куда он перенаправляет сигнал, в какую именно клетку. И тут, соответственно, важно давать возможность кастомизации, как именно подсвечивать, разные компоненты для этого и так далее.

### Будь проще, MWP

Нет, давайте без перенагруза. Без подсветки пока что. Без перемещения сетки мышью. Только отслеживание тех клеток, что сейчас под мышью, и работа с клавиатурой - вот это важно, это MWP.

### Управление проводимостью среды

Это некая отдельная панелька где-нибудь сверху справа. Даёт возможность пользователю установить время передачи сигналов - моментально, быстро (50ms), нормально (200ms), медленно (500ms). Конкретные задержки откалибруются при тестировании по ощущениям.

UI представляет из себя группу из четырёх кнопок. Выбрать одновременно можно только одну из них.

### вернёмся к Клаве

Что в итоге нужно элементам? Как слушать события?

Большинству нужно только слушать само нажатие клавиши. В панели с клавишами, однако, должно отображаться то, что клавиша зажата. Особый случай - это клавиши создания и удаления. Они (1) активны всё время нажатия, и (2) взаимоисключают друг друга. Если одна из них уже была зажата, то другая зажата быть может, но не будет активирована.

Значит, на одном уровне асбтракции у нас просто подписка на нажатия и отжатия.
